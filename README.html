<?xml version='1.0' encoding='utf-8' ?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"/></head><body><h1 id="EnterpriseIntegrationPatternswithApacheCamelandSpringIntegration.">Enterprise Integration Patterns with Apache Camel and Spring Integration.</h1><p>The domain used to demonstrate EIPs with the frameworks is a Bicycle Store.</p><p>The bike shop imports CSV delivery notes and orders.</p><p><img alt="Alt graphic" border="0" src="doc/eip.png"/></p><h2 id="Importofdeliverynotes">Import of delivery notes</h2><p>Each delivery note record is converted into a StockItem and sent to the eip.common.services.StockService.addStockItem(StockItem) method.
This method increases the number of items on stock for the matching the item number.
A delivery note is simple flat CSV file:
	FRAME; Road bike frame 60 cm;1935182366;103.95;2
	DRIVE; Shimano HG LX;1935182439;31.85;6</p><h3 id="SpringIntegration">Spring Integration</h3><p>Spring Integration does not support CSV files so we use Spring Batch for this.
The delivery note records are read one at a time, converted into a StockItem to be sent to the StockService.</p><h3 id="Camel">Camel</h3><p>Camel provides the CSV component. Together with the Split component a record at a time is converted to a StockItem (eip.camel.CsvToStockItemProcessor) and sent to the StockService.</p><h2 id="Importoforders">Import of orders</h2><p>An order consists of a header(record type 'ORDER') and and items(record type 'ITEM')<br/>
	ORDER;Bike support;1
	ITEM;FRAME;Road bike frame 60 cm;1935182366
	ITEM;DRIVE;Shimano HG LX;1935182439</p><p>All order items until next order block begins are read and mapped to an Order object.
The Order object is sent to the eip.common.services.OrderService.handleOrder(Order) method. 
The availability is queried from eip.common.services.StockService.getStockItem(String).
If available the number on stock is decreased, if not the method eip.common.services.BacklogService.orderBacklogItems(Backlog) is called
to add an entry in the database table BACKLOGITEM.</p><h3 id="SpringIntegration2">Spring Integration</h3><p>Again, Spring Batch does the heavy lifting. As the records has to be aggregated - read an ORDER, read all ITEM's until another ORDER or end of file 
the FlatFileItemReader is wrapped in eip.spring.integration.OrderFlatFileItemReaderDelegate.</p><h3 id="Camel2">Camel</h3><p>The Split component splits on the token "ORDER", and feeds the ORDER and its ITEM's to eip.camel.CsvToOrderProcessor.</p></body></html>